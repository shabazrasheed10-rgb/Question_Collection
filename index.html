<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collecting Questions</title>

<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f0f2f5; }

header {
  background-color: #2D2D2D;
  color: white;
  padding: 30px;
  text-align: center;
  font-size: 28px;
  font-weight: bold;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.container {
  max-width: 800px;
  margin: 20px auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.box {
  background: white;
  border: 1px solid #ddd;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.row { display: flex; align-items: center; gap: 15px; }
.number-label { font-size: 20px; font-weight: bold; color: #555; }

input[type="text"] {
  flex-grow: 1;
  padding: 12px;
  font-size: 16px;
  border: 2px solid #eee;
  border-radius: 6px;
  outline: none;
}
  h5{font-size:18px}

textarea {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 2px solid #eee;
  border-radius: 6px;
  min-height: 100px;
  resize: none;
  overflow: hidden;
  box-sizing: border-box;
  font-family: inherit;
}

.button-group {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

button {
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: opacity 0.2s;
}

.btn-save-name { background-color: #28a745; }
.btn-save-question { background-color: #dc3545; }

button:disabled {
  background-color: #cccccc !important;
  cursor: not-allowed;
  opacity: 0.6;
}
</style>
</head>

<body>

<header>Collecting questions
  <h5>Stage 1 - Block 1</h5>

</header>
<div class="container" id="grid"></div>

<!-- üî• Firebase COMPAT SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// üî• REAL FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyBlG3ihQM_Qky04Ud2qEW4vS6PPZ8pFkWw",
  authDomain: "question-collection-546f1.firebaseapp.com",
  projectId: "question-collection-546f1",
  storageBucket: "question-collection-546f1.appspot.com",
  messagingSenderId: "777734767160",
  appId: "1:777734767160:web:fdc32586aef36f72485ccd"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const grid = document.getElementById('grid');

// üîÅ BUILD UI (UNCHANGED)
for (let i = 1; i <= 100; i++) {
  const box = document.createElement('div');
  box.className = 'box';
  box.innerHTML = `
    <div class="row">
      <span class="number-label">${i}.</span>
      <input type="text" placeholder="Your Name" id="name-input-${i}" oninput="checkInput(${i}, 'name')">
    </div>

    <textarea placeholder="Write question" id="q-input-${i}" oninput="autoExpand(this); checkInput(${i}, 'question')"></textarea>

    <div class="button-group">
      <button id="btn-name-${i}" class="btn-save-name" onclick="lockField('name-input-${i}', 'btn-name-${i}')" disabled>Save name</button>
      <button id="btn-q-${i}" class="btn-save-question" onclick="lockField('q-input-${i}', 'btn-q-${i}')" disabled>Save question</button>
    </div>
  `;
  grid.appendChild(box);
}

// UI HELPERS (UNCHANGED)
function autoExpand(t) {
  t.style.height = 'inherit';
  t.style.height = t.scrollHeight + 'px';
}

function checkInput(index, type) {
  const input = document.getElementById(type === 'name' ? `name-input-${index}` : `q-input-${index}`);
  const btn = document.getElementById(type === 'name' ? `btn-name-${index}` : `btn-q-${index}`);
  btn.disabled = input.value.trim() === "";
}

// üíæ SAVE + LOCK
function lockField(inputId, btnId) {
  const input = document.getElementById(inputId);
  const btn = document.getElementById(btnId);

  const index = inputId.split('-').pop();
  const field = inputId.includes('name') ? 'name' : 'question';

  db.collection("questions").doc(index).set({
    [field]: input.value
  }, { merge: true });

  input.readOnly = true;
  input.style.backgroundColor = "#f9f9f9";
  btn.disabled = true;
  btn.innerText = "Saved";
}

// üì• LOAD DATA ON PAGE LOAD
db.collection("questions").get().then(snapshot => {
  snapshot.forEach(doc => {
    const i = doc.id;
    const data = doc.data();

    if (data.name) {
      const n = document.getElementById(`name-input-${i}`);
      const b = document.getElementById(`btn-name-${i}`);
      n.value = data.name;
      n.readOnly = true;
      n.style.backgroundColor = "#f9f9f9";
      b.disabled = true;
      b.innerText = "Saved";
    }

    if (data.question) {
      const q = document.getElementById(`q-input-${i}`);
      const b = document.getElementById(`btn-q-${i}`);
      q.value = data.question;
      autoExpand(q);
      q.readOnly = true;
      q.style.backgroundColor = "#f9f9f9";
      b.disabled = true;
      b.innerText = "Saved";
    }
  });
});
</script>

</body>
</html>
